{"version":3,"sources":["shared/zoneState.ts","constants.ts","Countdown.tsx","api.tsx","App.tsx","zoneInfo.ts","CoopDoor.tsx","zoneControl.ts","Zone.tsx","reportWebVitals.ts","index.tsx"],"names":["ZoneState","SERVER_ADDRESS","API_LOCATION","WS_LOCATION","DOOR_MOVE_DURATION_MS","Countdown","initial","remaining","children","dir","style","top","className","persistZoneState","zoneInfo","a","fetch","id","state","then","rsp","json","WsStatus","ws","on","ON","off","OFF","initialZoneInfo","CoopDoor","name","zoneInfos","openZoneInfo","closeZoneInfo","React","useState","undefined","setRemaining","oc","setOc","run","zone","duration","stepCallback","step","msRemaining","setTimeout","interval","setInterval","clearInterval","runZone","handleRemaining","onClick","Zone","zoneState","toggleState","initialInfos","i","init","produce","draft","push","App","setZoneInfos","CONNECTING","wsStatus","setWsStatus","getZone","foundZone","forEach","z","useEffect","ERROR","WebSocket","onopen","send","JSON","stringify","msg","OPEN","onmessage","message","data","console","log","parse","parseInt","e","Error","updatedZoneInfos","onclose","CLOSED","onerror","close","z5","z6","z7","z8","filter","map","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ca3aa472.chunk.js","sourcesContent":["export enum ZoneState {\n    ON = 'on',\n    OFF = 'off',\n}\n\nexport const toggleZoneState = (zoneState: ZoneState): ZoneState => {\n    return zoneState === ZoneState.ON ? ZoneState.OFF : ZoneState.ON\n}","const WS_PORT = 1337;\nconst REST_PORT = 3217;\n\n// export const SERVER_ADDRESS = 'localhost';\nexport const SERVER_ADDRESS = '10.0.0.28';\nexport const API_LOCATION = `http://${SERVER_ADDRESS}:${REST_PORT}`;\nexport const WS_LOCATION = `ws://${SERVER_ADDRESS}:${WS_PORT}`;\nexport const NUM_ZONES = 8;\n\nconst ONE_SEC_IN_MS = 1000;\nexport const DOOR_MOVE_DURATION_MS = 20 * ONE_SEC_IN_MS;\n","import React from 'react';\nimport { milliseconds } from \"./shared/time\";\nimport './countdown.css';\n\nexport const Countdown = ({ initial, remaining, children, dir = 'down' }: { initial: milliseconds, remaining: milliseconds, children?: JSX.Element | string, dir?: 'down' | 'up' }) => {\n    const style = dir === 'down' ? {top: `${100 - (remaining/initial)*100}%`} : {top: `${(remaining/initial)*100}%`}\n    return  <div className=\"countdown\">\n        <div className=\"countdown-phaser\" style={style}></div>\n        <div className=\"countdown-children\">{children}</div>\n    </div>;\n}","import { API_LOCATION } from \"./constants\";\nimport { ZoneInfo } from \"./zoneInfo\";\n\nexport const persistZoneState = async (zoneInfo: ZoneInfo):Promise<ZoneInfo> => fetch(`${API_LOCATION}/channel/${zoneInfo.id}/${zoneInfo.state}`).then(rsp => rsp.json());\n","import produce from 'immer';\nimport React from 'react';\nimport './App.css';\nimport { NUM_ZONES, WS_LOCATION } from './constants';\nimport { CoopDoor } from './CoopDoor';\nimport { Zone } from './Zone';\nimport { initialZoneInfo, ZoneInfo } from './zoneInfo';\n\nlet initialInfos: ZoneInfo[] = [];\n\nfor (let i = 1; i <= NUM_ZONES; i++) {\n    const init = produce(initialZoneInfo, draft => { draft.id = i })\n    initialInfos.push(init);\n}\n\nenum WsStatus {\n    CONNECTING = 'connecting',\n    OPEN = 'open',\n    CLOSED = 'closed',\n    ERROR = 'error',\n}\n\nlet ws: WebSocket;\n\nfunction App() {\n    const [zoneInfos, setZoneInfos] = React.useState<ZoneInfo[]>(initialInfos);\n    const [wsStatus, setWsStatus] = React.useState<WsStatus>(WsStatus.CONNECTING);\n\n    const getZone = (id: ZoneInfo['id']): ZoneInfo | undefined => {\n        let foundZone: ZoneInfo | undefined;\n        zoneInfos.forEach((z) => {\n            if (z.id === id) {\n                foundZone = z;\n            }\n        });\n        return foundZone;\n    }\n\n    React.useEffect(() => {\n        if (wsStatus === WsStatus.ERROR || ws) return;\n\n        ws = new WebSocket(WS_LOCATION);\n        ws.onopen = () => {\n            ws.send(JSON.stringify({ id: undefined, msg: 'Client connected!' }));\n            setWsStatus(WsStatus.OPEN);\n        };\n\n        ws.onmessage = (message: any) => {\n            if (!(message || message.data)) {\n                console.log('Error receving ws message or message data', message);\n            }\n            let zoneInfo: ZoneInfo;\n            try {\n                zoneInfo = JSON.parse(message.data);\n                zoneInfo.id = parseInt(zoneInfo.id as unknown as string, 10);\n            } catch (e) {\n                console.log('Error parsing message.data from websockets');\n                throw new Error(e);\n            }\n            console.log('message from server', zoneInfo)\n            const updatedZoneInfos = produce(zoneInfos, draft => { draft[zoneInfo.id - 1] = zoneInfo });\n            setZoneInfos(updatedZoneInfos);\n        };\n        ws.onclose = () => setWsStatus(WsStatus.CLOSED);\n        ws.onerror = () => {\n            ws.close();\n            setWsStatus(WsStatus.ERROR);\n        }\n    }, [wsStatus, zoneInfos])\n\n    const z5 = getZone(5);\n    const z6 = getZone(6);\n    const z7 = getZone(7);\n    const z8 = getZone(8);\n\n    return (\n        <div className=\"App\">\n            <header className=\"App-header\">\n                <h1 className=\"title\">Martins' Sprinklers</h1>\n                <div className=\"ws-status\">connection: {wsStatus}</div>\n            </header>\n            \n            <div className=\"controls\">\n                { z5 && z6 ? <CoopDoor name=\"Chickens\" zoneInfos={[ z6, z5 ]} /> : null }\n                { z7 && z8 ? <CoopDoor name=\"Ducks\" zoneInfos={[ z7, z8 ]} /> : null }\n                {\n                    zoneInfos\n                        .filter((z: ZoneInfo) => z.id <= 8) // zones 5-8 are for coop doors\n                        .map((z: ZoneInfo) => <Zone key={z.id} zoneInfo={z} />)\n                }\n            </div>\n            \n            \n        </div>\n    );\n}\n\nexport default App;\n","import { toggleZoneState, ZoneState } from \"./shared/zoneState\";\n\nexport const toggleState = (zoneInfo: ZoneInfo): ZoneInfo => {\n    return {\n        ...zoneInfo,\n        state: toggleZoneState(zoneInfo.state),\n    };\n}\n\nexport const on = (zoneInfo: ZoneInfo): ZoneInfo => {\n    return {\n        ...zoneInfo,\n        state: ZoneState.ON,\n    };\n}\n\nexport const off = (zoneInfo: ZoneInfo): ZoneInfo => {\n    return {\n        ...zoneInfo,\n        state: ZoneState.OFF,\n    };\n}\n\nexport interface ZoneInfo {\n    id: number,\n    state: ZoneState,\n    // msg: string, // TODO\n}\n\nexport const initialZoneInfo: ZoneInfo = {\n    id: 0,\n    state: ZoneState.OFF,\n}\n\n","import React from 'react';\nimport { DOOR_MOVE_DURATION_MS } from './constants';\nimport { milliseconds } from \"./shared/time\";\nimport './coopDoor.css';\nimport { Countdown } from './Countdown';\nimport { runZone } from './zoneControl';\nimport { ZoneInfo } from './zoneInfo';\n\n\nexport const CoopDoor = ({name, zoneInfos}: {name: string, zoneInfos: [ZoneInfo, ZoneInfo]}) => {\n    const openZoneInfo: ZoneInfo = zoneInfos[0];\n    const closeZoneInfo: ZoneInfo = zoneInfos[1];\n    const [remaining, setRemaining] = React.useState<milliseconds|undefined>(undefined);\n    const [oc, setOc] = React.useState<'opening' | 'closing' | undefined>(undefined);\n\n    const run = (zoneInfo: ZoneInfo) => {\n        if (!(remaining && remaining > 0)) {\n            runZone(zoneInfo, DOOR_MOVE_DURATION_MS, handleRemaining);\n        }\n    }\n\n    const handleRemaining = (remaining: milliseconds) => {\n        if (remaining && remaining > 0) {\n            setRemaining(remaining);\n        } else {\n            setRemaining(undefined);\n            setOc(undefined);\n        }\n    }\n\n    return <div className=\"coop-door\">\n        <div className=\"coop-door_open btn\" onClick={() => { setOc('opening'); run(openZoneInfo); }}>\n            {remaining && oc === 'opening' ? <Countdown initial={DOOR_MOVE_DURATION_MS} remaining={remaining} dir=\"up\"><div>Open {openZoneInfo.id}</div></Countdown> : `Open ${openZoneInfo.id}`}\n        </div>\n        {name} {remaining ? `${remaining/1000}s`: null}\n        <div className=\"coop-door_close btn\" onClick={() => { setOc('closing'); run(closeZoneInfo); }}>\n            {remaining && oc === 'closing' ? <Countdown initial={DOOR_MOVE_DURATION_MS} remaining={remaining}><div>Close {closeZoneInfo.id}</div></Countdown> : `Close ${closeZoneInfo.id}`}\n        </div>\n    </div>\n}","import { persistZoneState } from \"./api\";\nimport { milliseconds } from \"./shared/time\";\nimport { off, on, ZoneInfo } from \"./zoneInfo\";\n\nexport const runZone = (zone: ZoneInfo, duration: milliseconds, stepCallback: (remaining: milliseconds) => void, step: milliseconds = 1000) => {\n    let msRemaining = duration;\n    persistZoneState(on(zone));\n    setTimeout(() => {\n        persistZoneState(off(zone));\n    }, duration);\n    \n    stepCallback(msRemaining);\n    const interval = setInterval(() => {\n        if (msRemaining <= 0) {\n            clearInterval(interval);\n        } else {\n            msRemaining = msRemaining - step;\n            stepCallback(msRemaining);\n        }\n    }, step);\n}","import { persistZoneState } from './api';\nimport { ZoneInfo } from './zoneInfo';\nimport { toggleState } from './zoneInfo';\nimport './zone.css';\n\nexport const Zone = ({zoneInfo}: {zoneInfo: ZoneInfo}) => {\n    return <div\n        className={`zone btn ${zoneInfo.state}`}\n        onClick={() => persistZoneState(toggleState(zoneInfo))}\n    >\n        Zone {zoneInfo.id}\n    </div>\n}","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}